<!DOCTYPE html>

<html>

<head>
    <title>NNCode</title>
    <link rel="icon" href="/www/favicon.ico" sizes="100x100" type="image/x-icon">
</head>

<script src="/www/js/index.js"></script>

<body style="background-color: black;">
    <div id="main">
        <h1>NNCode</h1>
        <!-- <textarea id="test" oninput="resize(this)" placeholder="help"></textarea> -->

        <hr>

        <h3>Cipher</h3>
        <h6>(only 26 alphanumerical characters will be used)</h6>
        <textarea id="cipher" oninput="resize(this)" placeholder="Type your cipher here..."></textarea>
        <h3>Usable Cipher Preview</h3>
        <textarea id="cipher_preview" placeholder="<blank>" disabled></textarea>

        <hr>

        <h3>Message</h3>
        <textarea id="message" oninput="resize(this)" type="text" placeholder="Type your message here..."></textarea>
        <h6><label>Keep Whitespace <input id="keep_whitespace" type="checkbox"></label></h6>
        <button id="encode">NNcode on that thang!</button>
        <button id="decode">DDcode on that thang!</button>

        <hr>

        <h3>Output</h3>
        <textarea id="ciphertext" oninput="resize(this)" placeholder="Hack Tuah!"></textarea>
    </div>
</body>

<style>
    @font-face {
        font-family: "Comic Sans MS3";
        src: url("/www/fonts/comic.woff") format("woff");
    }

    @font-face {
        font-family: "Consolas";
        src: url("/www/fonts/consolas.woff") format("woff");
    }

    @font-face {
        font-family: "Bad Handwriting";
        src: url("/www/fonts/bad.woff") format("woff");
    }

    @font-face {
        font-family: "AA Typewriter";
        src: url("/www/fonts/typewriter.woff") format("woff");
    }

    #main {
        font-family: "Bad Handwriting";
        text-align: center;
        background-color: black;
        color: cyan;
    }

    button {
        font-family: "Bad Handwriting";
        background-color: black;
        color: cyan;
    }

    textarea {
        font-family: "AA Typewriter";

        width: auto;
        height: auto;

        overflow: hidden;
        resize: none;
        white-space: nowrap;

        padding: 8px 12px;
        margin: 8px;

        border-radius: 6px;
        background-color: black;
        border: 1px solid gray;
        color: cyan;
    }
</style>

<script>
    function resize(el) {
        el.style.height = 'auto';
        el.style.height = el.scrollHeight + 'px';
        el.style.width = 'auto';
        el.style.width = el.scrollWidth + 'px';
    }

    async function dramatic(el, text, ms = 10) {
        el.value = "";
        encode.disabled = true;
        decode.disabled = true;
        for (const char of text) {
            await new Promise(resolve => setTimeout(resolve, ms));
            el.value += char;
            resize(el);
        }
        updateEncodeButton();
    }

    const cipher = document.getElementById('cipher');
    const cipher_preview = document.getElementById('cipher_preview');
    const input = document.getElementById('message');
    const encode = document.getElementById('encode');
    const decode = document.getElementById('decode');
    const output = document.getElementById('ciphertext');
    const keep_whitespace = document.getElementById('keep_whitespace');
    // const test = document.getElementById('test');

    encode.disabled = true;
    decode.disabled = true;

    let cipher_usable = false;
    let message_usable = false;

    function updateEncodeButton() {
        encode.disabled = !(cipher_usable && message_usable);
        decode.disabled = !(cipher_usable && message_usable);
    }

    cipher.addEventListener('input', () => {
        cipher_preview.value = SanitizeCipher(cipher.value);
        resize(cipher_preview);
        cipher_usable = !(cipher_preview.value == '' || cipher_preview.value == undefined);
        updateEncodeButton();
    });

    message.addEventListener('input', () => {
        message_usable = !(message.value == '' || message.value == undefined);
        updateEncodeButton();
    });

    // experiment: swapping 'output' with 'input'

    encode.addEventListener('click', async () => {
        CreateDictionaries(cipher.value);
        await dramatic(output, NNCode(input.value, keep_whitespace.checked), 10);
    });

    decode.addEventListener('click', async () => {
        CreateDictionaries(cipher.value);
        // output.value = DDCode(input.value);
        await dramatic(output, DDCode(input.value), 10);
    });

    for (const el of document.getElementById('main').children) { // initial resize on all textarea
        el.type === 'textarea' && resize(el);
    }

</script>

</html>